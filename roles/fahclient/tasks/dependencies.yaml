---

- name: install required packages (RPM)
  package:
    name:
      - compat-openssl10
      - freeglut
      - libcanberra-gtk2
      - make
      - mesa-libGLU
      - pygtk2
      - python2
    state: present
  tags: local-service
  when: "ansible_distribution == 'RedHat' or ansible_distribution == 'Fedora'"

# Amazon linux doesn't have compat-openssl10.
# Library comes with Amazon Linux openssl package
- name: install required packages (RPM)
  package:
    name:
      - freeglut
      - libcanberra-gtk2
      - make
      - mesa-libGLU
      - pygtk2
      - python2
    state: present
  when: "ansible_distribution == 'Amazon'"

- name: Gather package facts
  package_facts:
    manager: auto

- name: download packages for the FaH client
  get_url:
    url: "{{ item }}"
    dest: /tmp
  with_items: "{{ fah_pkgs[ ansible_distribution ] }}"
  when: "'fahclient' not in ansible_facts.packages"

- name: install FaH packages (RPM)
  command: "rpm -ivh --nodeps --noscripts /tmp/{{ item | regex_replace( '.*fah', 'fah' ) }}"
  with_items: "{{ fah_pkgs[ ansible_distribution ] }}"
  when: "'fahclient' not in ansible_facts.packages and ( ansible_distribution == 'RedHat' or ansible_distribution == 'Fedora' or ansible_distribution == 'Amazon' )"

- name: install FaH packages (DEB)
  apt:
#      deb: "{{ item }}"
    deb: "/tmp/{{ item | regex_replace( '.*fah', 'fah' ) }}"
#    package:
#      name: "/tmp/{{ item | regex_replace( '.*fah', 'fah' ) }}"
  with_items: "{{ fah_pkgs[ ansible_distribution ] }}"
  when: "'fahclient' not in ansible_facts.packages and ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'"
  