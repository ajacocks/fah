---
- hosts: all
  become: true
  tasks:

    - name: Make sure python-apt installed on Debian based hosts
      apt:
        name: python-apt
        state: present
        update_cache: true
      when:
        (ansible_distribution == 'Debian') or
        (ansible_distribution == 'Ubuntu' and ansible_distribution_release != 'jammy')

    - name: Populate service facts
      service_facts:
      tags: always


- hosts: clients
  become: true
  tasks:

    - name: Include GPU tasks if enabled
      include_tasks: gpu.yaml
      # static: no
      when: (gpu | bool)

    - import_role:
        name: fahclient

    - import_role:
        name: podman
      when: (podman | bool)

    - import_role:
        name: docker
      when: (docker | bool)

- hosts: controllers
  become: true
  tasks:

    - import_role:
        name: fahcontroller

- hosts: viewers
  become: true
  tasks:

    - import_role:
        name: fahviewer

...
